<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Gateway Route Config</title>
	<style>
		body {
			font-family: Arial;
		}

		table {
			border-collapse: collapse;
			width: 100%;
			margin-top: 20px;
		}

		th,
		td {
			border: 1px solid #444;
			padding: 8px;
			text-align: left;
		}

		th {
			background: #eee;
		}

		input,
		select,
		button {
			margin-bottom: 8px;
		}

		.delete-btn {
			color: red;
			font-weight: bold;
			cursor: pointer;
			border: none;
			background: none;
		}
	</style>
</head>

<body>

	<h2>Add / Update Gateway Route</h2>

	<input type="number" id="id" placeholder="ID (optional)"><br>

	<input type="text" id="urlPattern" placeholder="URL Pattern"><br>

	<select id="httpMethod">
		<option>GET</option>
		<option>POST</option>
		<option>PUT</option>
		<option>DELETE</option>
	</select><br>

	<input type="text" id="targetUrl" placeholder="Target URL"><br>

	<label>
		<input type="checkbox" id="authRequired"> Auth Required
	</label><br>

	<input type="text" id="role" placeholder="Role"><br>

	<button onclick="saveRoute()">Save Route</button>

	<p id="status"></p>

	<hr>

	<h2>Existing Routes</h2>

	<table>
		<thead>
			<tr>
				<th>ID</th>
				<th>Pattern</th>
				<th>Method</th>
				<th>Target</th>
				<th>Auth</th>
				<th>Role</th>
				<th>Delete</th>
			</tr>
		</thead>
		<tbody id="routesBody"></tbody>
	</table>

	<script>
		async function loadRoutes() {
			const res = await fetch("/admin/display");
			if (!res.ok) return;

			const data = await res.json();
			const body = document.getElementById("routesBody");
			body.innerHTML = "";

			data.forEach(r => {
				body.innerHTML += `
        <tr>
            <td>${r.id}</td>
            <td>${r.urlPattern}</td>
            <td>${r.httpMethod}</td>
            <td>${r.targetUrl}</td>
            <td>${r.authRequired}</td>
            <td>${r.role ?? ""}</td>
            <td>
                <button class="delete-btn"
                        onclick="deleteRoute(${r.id})">‚ùå</button>
            </td>
        </tr>`;
			});
		}

		async function saveRoute() {
			const payload = {
				id: document.getElementById("id").value || null,
				urlPattern: document.getElementById("urlPattern").value,
				httpMethod: document.getElementById("httpMethod").value,
				targetUrl: document.getElementById("targetUrl").value,
				authRequired: document.getElementById("authRequired").checked,
				role: document.getElementById("role").value
			};

			const res = await fetch("/admin/routes/save", {
				method: "POST",
				headers: {"Content-Type": "application/json"},
				body: JSON.stringify(payload)
			});

			const status = document.getElementById("status");

			if (res.ok) {
				status.innerText = "OK";
				loadRoutes();
			} else {
				status.innerText = "ERROR";
			}
		}

		async function deleteRoute(id) {
			if (!confirm("Delete this route?")) return;

			const res = await fetch(`/admin/routes/delete/${id}`, {
				method: "DELETE"
			});

			if (res.ok) {
				loadRoutes();
			} else {
				alert("Delete failed");
			}
		}

		window.onload = loadRoutes;
	</script>

</body>

</html>
